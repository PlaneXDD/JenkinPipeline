// This is a test comment to trigger the Jenkins pipeline
pipeline {
    agent any

    environment {
        // Securely fetch the Gmail credentials stored in Jenkins
        EMAIL_CREDS = credentials('gmail-creds')
    }

    stages {
        stage('Prepare Environment') {
            steps {
                echo 'Preparing the environment...'
                // Add any preparation commands here, like setting up directories or environment variables
            }
        }

        stage('Build') {
            steps {
                echo 'Building the project...'
                // A simple echo command to simulate the build process
                bat 'echo Build successful' // For Windows
                // sh 'echo Build successful' // For Linux/MacOS
            }
        }

        stage('Test') {
            steps {
                echo 'Running tests...'
                // Replace with actual test commands, e.g., running a script
                bat 'echo Tests passed' // For Windows
                // sh 'echo Tests passed' // For Linux/MacOS
            }
        }

        stage('Package') {
            steps {
                echo 'Packaging the application...'
                // Include packaging commands, such as creating a zip or tar file
                bat 'echo Packaging done' // For Windows
                // sh 'echo Packaging done' // For Linux/MacOS
            }
        }
    }

    post {
        success {
            // Send success notification email
            mail to: 'phamthienphu2604@gmail.com',
                 subject: "Pipeline succeeded: ${currentBuild.fullDisplayName}",
                 body: "The pipeline has completed successfully.",
                 from: "${env.EMAIL_CREDS_USR}",
                 replyTo: 'phamthienphu2604@gmail.com'
        }
        failure {
            // Send failure notification email
            mail to: 'phamthienphu2604@gmail.com',
                 subject: "Pipeline failed: ${currentBuild.fullDisplayName}",
                 body: "The pipeline has failed. Please check the Jenkins console for details.",
                 from: "${env.EMAIL_CREDS_USR}",
                 replyTo: 'phamthienphu2604@gmail.com'
        }
    }
}
